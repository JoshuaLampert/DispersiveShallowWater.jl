<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · DispersiveShallowWater.jl</title><meta name="title" content="Overview · DispersiveShallowWater.jl"/><meta property="og:title" content="Overview · DispersiveShallowWater.jl"/><meta property="twitter:title" content="Overview · DispersiveShallowWater.jl"/><meta name="description" content="Documentation for DispersiveShallowWater.jl."/><meta property="og:description" content="Documentation for DispersiveShallowWater.jl."/><meta property="twitter:description" content="Documentation for DispersiveShallowWater.jl."/><meta property="og:url" content="https://JoshuaLampert.github.io/DispersiveShallowWater.jl/stable/overview/"/><meta property="twitter:url" content="https://JoshuaLampert.github.io/DispersiveShallowWater.jl/stable/overview/"/><link rel="canonical" href="https://JoshuaLampert.github.io/DispersiveShallowWater.jl/stable/overview/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DispersiveShallowWater.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Overview</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Define-physical-setup"><span>Define physical setup</span></a></li><li><a class="tocitem" href="#Define-numerical-solver"><span>Define numerical solver</span></a></li><li><a class="tocitem" href="#Solve-system-of-ordinary-differential-equations"><span>Solve system of ordinary differential equations</span></a></li><li><a class="tocitem" href="#visualize_results"><span>Visualize results</span></a></li><li><a class="tocitem" href="#Use-entropy-conserving-time-integration"><span>Use entropy-conserving time integration</span></a></li><li><a class="tocitem" href="#customize_solver"><span>Customize solver</span></a></li><li><a class="tocitem" href="#Additional-resources"><span>Additional resources</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../ref/">Reference</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JoshuaLampert/DispersiveShallowWater.jl/blob/main/docs/src/overview.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Running-a-simulation"><a class="docs-heading-anchor" href="#Running-a-simulation">Running a simulation</a><a id="Running-a-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-simulation" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>In this tutorial we describe how to numerically solve the BBM-BBM (Benjamin-Bona-Mahony) equations with variable bottom topography in one dimension, which has been proposed in <sup class="footnote-reference"><a id="citeref-IsrawiKalischKatsaounisMitsotakis2021" href="#footnote-IsrawiKalischKatsaounisMitsotakis2021">[IsrawiKalischKatsaounisMitsotakis2021]</a></sup> for two spatial dimensions. The equations describe a dispersive shallow water model, i.e. they extend the well-known shallow water equations in the sense that dispersion is modeled. The shallow water equations are a system of first order hyperbolic partial differential equations that can be written in the form of a balance law. In contrast, the BBM-BBM equations additionally include third-order mixed derivatives. In primitive variables <span>$q = (\eta, v)$</span> they can be written as:</p><p class="math-container">\[\begin{aligned}
  \eta_t + ((\eta + D)v)_x - \frac{1}{6}(D^2\eta_{xt})_x &amp;= 0,\\
  v_t + g\eta_x + \left(\frac{1}{2}v^2\right)_x - \frac{1}{6}(D^2v_t)_{xx} &amp;= 0.
\end{aligned}\]</p><p>Here, <span>$\eta = h + b$</span> describes the total water height, <span>$h$</span> the water height above the bottom topography (bathymetry), <span>$b = -D$</span> the bathymetry and <span>$v$</span> the velocity in horizontal direction. The gravitational acceleration is denoted as <span>$g$</span>. A sketch of the water height and the bathymetry can be found below.</p><p><img src="../bathymetry.png" alt/></p><p>In order to conduct a numerical simulation with DispersiveShallowWater.jl, we perform the following steps.</p><p>First, we load the necessary libraries:</p><pre><code class="language-julia hljs">using DispersiveShallowWater, OrdinaryDiffEq</code></pre><h2 id="Define-physical-setup"><a class="docs-heading-anchor" href="#Define-physical-setup">Define physical setup</a><a id="Define-physical-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Define-physical-setup" title="Permalink"></a></h2><p>As a first step of a numerical simulation, we define the physical setup we want to solve. This includes the set of equations, potentially including physical parameters, initial and boundary conditions as well as the domain. In the following example, the initial condition describes a travelling wave that moves towards a beach, which is modeled by a linearly increasing bathymetry.</p><pre><code class="language-julia hljs">equations = BBMBBMVariableEquations1D(gravity_constant = 9.81)

function initial_condition_shoaling(x, t, equations::BBMBBMVariableEquations1D, mesh)
    A = 0.07 # amplitude of wave
    x0 = -30 # initial center
    eta = A * exp(-0.1*(x - x0)^2)
    v = 0
    D = x &lt;= 0.0 ? 0.7 : 0.7 - 1/50 * x
    return SVector(eta, v, D)
end

initial_condition = initial_condition_shoaling
boundary_conditions = boundary_condition_periodic

coordinates_min = -130.0
coordinates_max = 20.0
N = 512
mesh = Mesh1D(coordinates_min, coordinates_max, N + 1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Mesh1D{Float64} 
    xmin: -130.0
    xmax: 20.0
    N: 513</code></pre><p>The first line specifies that we want to solve the BBM-BBM equations with variable bathymetry using a gravitational acceleration <span>$g = 9.81$</span>. Afterwards, we define the initial condition, which is described as a function with the spatial variable <code>x</code>, the time <code>t</code>, the <code>equations</code> and a <code>mesh</code> as parameters. If an analytical solution is available, the time variable <code>t</code> can be used, and the initial condition can serve as an analytical solution to be compared with the numerical solution. Otherwise, you can just keep the time variable unused. An initial condition in DispersiveShallowWater.jl is supposed to return an <code>SVector</code> holding the values for each of the unknown variables. Since the bathymetry is treated as a variable (with time derivative 0) for convenience, we need to provide the value for the primitive variables <code>eta</code> and <code>v</code> as well as for <code>D</code>.</p><p>Next, we choose periodic boundary conditions since, up to now, DispersiveShallowWater.jl only provides support for this type of boundary conditions. Lastly, we define the physical domain as the interval from -130 to 20 and we choose 512 intermediate nodes. The mesh is homogeneous, i.e. the distance between each two nodes is constant. We choose the left boundary very far to the left in order to avoid an interaction of the left- and right-travelling waves.</p><h2 id="Define-numerical-solver"><a class="docs-heading-anchor" href="#Define-numerical-solver">Define numerical solver</a><a id="Define-numerical-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Define-numerical-solver" title="Permalink"></a></h2><p>In the next step, we build a <a href="../ref/#DispersiveShallowWater.Semidiscretization"><code>Semidiscretization</code></a> that bundles all ingredients for the spatial discretization of the model. Especially, we need to define a <a href="../ref/#DispersiveShallowWater.Solver"><code>Solver</code></a>. The simplest way to define a solver is to call the constructor by providing the mesh and a desired order of accuracy. In the following example, we use an accuracy order of 4. The default constructor simply creates periodic first- and second-derivative central finite difference summation by parts operators of the provided order of accuracy. How to use other summation by parts operators, is described in the section on <a href="#customize_solver">how to customize the solver</a>.</p><pre><code class="language-julia hljs">solver = Solver(mesh, 4)

semi = Semidiscretization(mesh, equations, initial_condition, solver, boundary_conditions = boundary_conditions)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Semidiscretization
    #spatial dimensions: 1
    mesh: Mesh1D{Float64} with length 513
    equations: BBMBBMVariableEquations1D
    initial condition: initial_condition_shoaling
    boundary condition: boundary_condition_periodic
    source terms: nothing</code></pre><p>Finally, we put the <code>mesh</code>, the <code>equations</code>, the <code>initial_condition</code>, the <code>solver</code> and the <code>boundary_conditions</code> together in a semidiscretization <code>semi</code>.</p><h2 id="Solve-system-of-ordinary-differential-equations"><a class="docs-heading-anchor" href="#Solve-system-of-ordinary-differential-equations">Solve system of ordinary differential equations</a><a id="Solve-system-of-ordinary-differential-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Solve-system-of-ordinary-differential-equations" title="Permalink"></a></h2><p>Once we have obtained a semidiscretization, we can solve the resulting system of ordinary differential equations. To do so, we specify the time interval that we want to simulate and obtain an <code>ODEProblem</code> from the <a href="https://diffeq.sciml.ai/latest/">SciML ecosystem for ordinary differential equations</a> by calling <a href="../ref/#DispersiveShallowWater.semidiscretize-Tuple{Semidiscretization, Any}"><code>semidiscretize</code></a> on the semidiscretization and the time span. Additionally, we can analyze the numerical solution using an <a href="../ref/#DispersiveShallowWater.AnalysisCallback"><code>AnalysisCallback</code></a>. The analysis includes computing the <span>$L^2$</span> error and <span>$L^\infty$</span> error of the different solution&#39;s variables compared to the initial condition (or, if available, at the same time analytical solution). Additional errors can be passed by the keyword argument <code>extra_analysis_errors</code>. Additional integral quantities that should be analyzed can be passed by keyword argument <code>extra_analysis_integrals</code>. In this example we pass the <code>conservation_error</code>, which computes the temporal change of the total amount (i.e. integral) of the different variables over time. In addition, the integrals of the total waterheight <span>$\eta$</span> <a href="../ref/#DispersiveShallowWater.waterheight_total"><code>waterheight_total</code></a>, the <a href="../ref/#DispersiveShallowWater.velocity"><code>velocity</code></a> and the <a href="../ref/#DispersiveShallowWater.entropy"><code>entropy</code></a> are computed and saved for each time step. The total waterheight and the total velocity are linear invariants of the BBM-BBM equations, i.e. they do not change over time. The total entropy</p><p class="math-container">\[\mathcal E(t; \eta, v) = \frac{1}{2}\int_\Omega g\eta^2 + (\eta + D)v^2\textrm{d}x\]</p><p>is a nonlinear invariant and should be constant over time as well. During the simulation, the <code>AnalysisCallback</code> will print the results to the terminal.</p><p>Finally, the <code>ode</code> can be <code>solve</code>d using the interface from <a href="https://github.com/SciML/OrdinaryDiffEq.jl">OrdinaryDiffEq.jl</a>. This means, we can specify a time-stepping scheme we want to use the tolerances for the adaptive time-stepping and the time values, where the solution values should be saved. In this case, we use the adaptive explicit Runge-Kutta method <code>Tsit5</code> by Tsitouras of order 5(4). Here, we save the solution at 100 equidistant points.</p><pre><code class="language-julia hljs">tspan = (0.0, 25.0)
ode = semidiscretize(semi, tspan)
analysis_callback = AnalysisCallback(semi; interval = 10,
                                     extra_analysis_errors = (:conservation_error,),
                                     extra_analysis_integrals = (waterheight_total,
                                                                 velocity, entropy),
                                     io = devnull)
callbacks = CallbackSet(analysis_callback)

saveat = range(tspan..., length = 100)
sol = solve(ode, Tsit5(), abstol = 1e-7, reltol = 1e-7,
            save_everystep = false, callback = callbacks, saveat = saveat)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 100-element Vector{Float64}:
  0.0
  0.25252525252525254
  0.5050505050505051
  0.7575757575757576
  1.0101010101010102
  1.2626262626262625
  1.5151515151515151
  1.7676767676767677
  2.0202020202020203
  2.272727272727273
  ⋮
 22.97979797979798
 23.232323232323232
 23.484848484848484
 23.737373737373737
 23.98989898989899
 24.242424242424242
 24.494949494949495
 24.747474747474747
 25.0
u: 100-element Vector{Vector{Float64}}:
 [0.0, 0.0, 0.7, 0.0, 0.0, 0.7, 0.0, 0.0, 0.7, 0.0  …  0.32339181286549706, 1.1159911034969113e-106, 0.0, 0.31754385964912274, 6.2568988186290324e-108, 0.0, 0.31169590643274847, 3.4485093610035348e-109, 0.0, 0.30584795321637426]
 [-3.3298063320105386e-56, 8.240555184525373e-57, 0.7, 3.4052487839602066e-56, 3.8721596046450877e-59, 0.7, -1.2823114010005487e-56, 4.5746067309011375e-57, 0.7, 9.837872827117964e-57  …  0.32339181286549706, 9.300749704670396e-55, -7.275157739846947e-55, 0.31754385964912274, -3.348584246232203e-55, 2.8353792349816592e-55, 0.31169590643274847, 9.261972052395447e-56, -9.944024391145692e-56, 0.30584795321637426]
 [-4.854627270617779e-53, 1.809712375822027e-53, 0.7, 4.842444655430691e-53, -1.4591991690482042e-55, 0.7, -1.8543823964202563e-53, 9.787480542672555e-54, 0.7, 1.4192813322404536e-53  …  0.32339181286549706, 1.2619264297387037e-51, -1.4764905451287523e-51, 0.31754385964912274, -4.641396873108809e-52, 5.871242596528972e-52, 0.31169590643274847, 1.320870503616519e-52, -2.0981320674476158e-52, 0.30584795321637426]
 [-1.161236430780927e-50, 5.352584402349824e-51, 0.7, 1.132047190334612e-50, -1.090865546552179e-52, 0.7, -4.404063115451628e-51, 2.8257688001594547e-51, 0.7, 3.363556071973813e-51  …  0.32339181286549706, 2.8189227454109665e-49, -4.048320798927971e-49, 0.31754385964912274, -1.058192942359117e-49, 1.6416176052934605e-49, 0.31169590643274847, 3.0941636353866156e-50, -5.973632917118691e-50, 0.30584795321637426]
 [-1.111984161777274e-48, 5.886881206722659e-49, 0.7, 1.0619527001701963e-48, -1.873587324635778e-50, 0.7, -4.191514844282648e-49, 3.04164693232564e-49, 0.7, 3.1953473695033716e-49  …  0.32339181286549706, 2.5336468214045444e-47, -4.1512198119827403e-47, 0.31754385964912274, -9.693390250020113e-48, 1.7143507420784363e-47, 0.31169590643274847, 2.906329540544282e-48, -6.344231008069559e-48, 0.30584795321637426]
 [-6.211496280528294e-47, 3.6607296186797117e-47, 0.7, 5.81547399618812e-47, -1.5891558132848647e-48, 0.7, -2.3283186142162194e-47, 1.8525166989190623e-47, 0.7, 1.7719350053561196e-47  …  0.32339181286549706, 1.3288096197339765e-45, -2.406573671857341e-45, 0.31754385964912274, -5.181053447216573e-46, 1.0122885108901054e-45, 0.31169590643274847, 1.5926495156599105e-46, -3.8101330106319815e-46, 0.30584795321637426]
 [-2.325463438823169e-45, 1.4921950096721943e-45, 0.7, 2.1372135258244082e-45, -8.159199150016775e-47, 0.7, -8.674201303018941e-46, 7.407033154029957e-46, 0.7, 6.59121517028004e-46  …  0.32339181286549706, 4.681077546331119e-44, -9.168673246160421e-44, 0.31754385964912274, -1.8589372716338307e-44, 3.9259940822661885e-44, 0.31169590643274847, 5.853556290472661e-45, -1.5021289571420408e-44, 0.30584795321637426]
 [-6.392817515195469e-44, 4.4001358292248024e-44, 0.7, 5.774217024408481e-44, -2.890251970346458e-45, 0.7, -2.374458385327122e-44, 2.1453565092353564e-44, 0.7, 1.80174698666066e-44  …  0.32339181286549706, 1.2132383431986734e-42, -2.532673744979001e-42, 0.31754385964912274, -4.904477697795913e-43, 1.1034157417570076e-42, 0.31169590643274847, 1.5807453384605294e-43, -4.289517343919539e-43, 0.30584795321637426]
 [-1.3787503503174236e-42, 1.0073886474279489e-42, 0.7, 1.2251193474315923e-42, -7.708120549579181e-44, 0.7, -5.102248833206378e-43, 4.8300534112044794e-43, 0.7, 3.8666581968804824e-43  …  0.32339181286549706, 2.4704751359942366e-41, -5.44118362661684e-41, 0.31754385964912274, -1.0162156286973175e-41, 2.41103787004135e-41, 0.31169590643274847, 3.350572348324435e-42, -9.51981151113154e-42, 0.30584795321637426]
 [-2.4329942701782505e-41, 1.8726572845802347e-41, 0.7, 2.1286192555782036e-41, -1.633848922522654e-42, 0.7, -8.97545663579173e-42, 8.838532404784254e-42, 0.7, 6.793904310090351e-42  …  0.32339181286549706, 4.120411791612597e-40, -9.504003130525254e-40, 0.31754385964912274, -1.7241821398234909e-40, 4.281941405290549e-40, 0.31169590643274847, 5.812886390913171e-41, -1.716752434217434e-40, 0.30584795321637426]
 ⋮
 [-0.002176856805330235, -0.005471508691304497, 0.7, -0.001099153144513662, -0.0029871877626791183, 0.7, -0.0005923337764093331, -0.0016674303283175998, 0.7, 0.0007288095726284696  …  0.32339181286549706, -0.0024465018058354463, -0.01637377384830735, 0.31754385964912274, -0.0016159836137553062, -0.01355179852781439, 0.31169590643274847, -0.0024066935622708515, -0.015385993847199006, 0.30584795321637426]
 [-0.00250587547149793, -0.008500215882787284, 0.7, -0.0018252401083375962, -0.008052197913994155, 0.7, -0.0012170710172800508, -0.006710223227505286, 0.7, -0.000434683690218956  …  0.32339181286549706, -0.0021856746220264536, -0.01596720905195473, 0.31754385964912274, -0.001926403010673724, -0.013402096254005912, 0.31169590643274847, -0.002238819035873335, -0.014632665884650491, 0.30584795321637426]
 [-0.0018622554232660391, -0.008813488862025372, 0.7, -0.0021123681485556273, -0.009894126107164069, 0.7, -0.002012840618838343, -0.009049578436370673, 0.7, -0.0018802163331253382  …  0.32339181286549706, -0.001421501025819743, -0.00996390185629101, 0.31754385964912274, -0.0019272324089571102, -0.012910684832531816, 0.31169590643274847, -0.0015105892195425286, -0.013900945522402237, 0.30584795321637426]
 [-0.0011336758604551511, -0.006535539122471322, 0.7, -0.001979219507900437, -0.00762411437774105, 0.7, -0.0023947609189682666, -0.00818600309699748, 0.7, -0.0027194686723747835  …  0.32339181286549706, -0.00034224853703385805, -0.00457376401027034, 0.31754385964912274, -0.0011555137032241494, -0.011452364518071361, 0.31169590643274847, -0.0008953442781766002, -0.012890538549893608, 0.30584795321637426]
 [-0.0008511358330743246, -0.003576478055447792, 0.7, -0.0015164577577977635, -0.0038311634821195746, 0.7, -0.0019345932262209958, -0.005644616064316158, 0.7, -0.002403265901442433  …  0.32339181286549706, 0.0004867695319956734, -0.0032409931754231974, 0.31754385964912274, -0.00013149800222093987, -0.00782656305647952, 0.31169590643274847, -0.0006596159967523298, -0.00951926804165878, 0.30584795321637426]
 [-0.0007926983849506771, -0.0017254112742892866, 0.7, -0.0009183634647562862, -0.0015781479578827905, 0.7, -0.0009349159821019416, -0.00340549925301533, 0.7, -0.001330648411503606  …  0.32339181286549706, 0.0007085992217667344, -0.003227914524735306, 0.31754385964912274, 0.0003672721353326862, -0.002719344223435364, 0.31169590643274847, -0.0005220550795835429, -0.004148042975382867, 0.30584795321637426]
 [-0.0005045949122517807, -0.0010626077342998173, 0.7, -0.00039778847670192055, -0.0013768855203502518, 0.7, -0.00012800109379730638, -0.00220010756935956, 0.7, -0.0004075931121329894  …  0.32339181286549706, 0.0005311117049730599, -0.0007705176971117157, 0.31754385964912274, 0.0002934328821294871, 0.0014618990740305471, 0.31169590643274847, -0.00014917439661154644, 0.0005201307641519544, 0.30584795321637426]
 [7.803777012583456e-5, -0.0004293626682829821, 0.7, -4.958365526498939e-5, -0.0013994492190674875, 0.7, 8.636575719673748e-5, -0.0013855062117348852, 0.7, -0.00013921328594872933  …  0.32339181286549706, 0.0004477809010451735, 0.003410122319406037, 0.31754385964912274, 0.00020695567860444395, 0.0031178119822825095, 0.31169590643274847, 0.00038934073344127154, 0.002756152881021689, 0.30584795321637426]
 [0.0006073616394551576, 0.000890705471058846, 0.7, 0.00018073121640876355, -8.677905121408308e-5, 0.7, -2.6115529692313e-5, -0.00015434992446148764, 0.7, -0.00025246394088185216  …  0.32339181286549706, 0.0006577431971269968, 0.005711584342450851, 0.31754385964912274, 0.00043018536651270086, 0.003066967628013788, 0.31169590643274847, 0.0007358879405425109, 0.003315270056768716, 0.30584795321637426]</code></pre><p>After solving the equations, <code>sol</code> contains the solution for each of the three variables at every spatial point for each of the 100 points in time. The errors and integrals recorded by the <code>AnalysisCallback</code> can be obtained as <code>NamedTuple</code>s by <a href="../ref/#DispersiveShallowWater.errors-Union{Tuple{SciMLBase.DiscreteCallback{Condition, Affect!}}, Tuple{Affect!}, Tuple{Condition}} where {Condition, Affect!&lt;:AnalysisCallback}"><code>errors(analysis_callback)</code></a> and <a href="../ref/#DispersiveShallowWater.integrals-Union{Tuple{SciMLBase.DiscreteCallback{Condition, Affect!}}, Tuple{Affect!}, Tuple{Condition}} where {Condition, Affect!&lt;:AnalysisCallback}"><code>integrals(analysis_callback)</code></a>.</p><h2 id="visualize_results"><a class="docs-heading-anchor" href="#visualize_results">Visualize results</a><a id="visualize_results-1"></a><a class="docs-heading-anchor-permalink" href="#visualize_results" title="Permalink"></a></h2><p>After running the simulation, the results can be visualized using <a href="https://github.com/JuliaPlots/Plots.jl">Plots.jl</a>, which needs to be imported first. Then, we can plot the solution at the final time by calling <code>plot</code> on a <code>Pair</code> of the <code>Semidiscretization</code> and the corresponding <code>ODESolution</code> <code>sol</code>. The result is depicted in the following picture.</p><pre><code class="language-julia hljs">using Plots

plot(semi =&gt; sol)
savefig(&quot;shoaling_solution.png&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/DispersiveShallowWater.jl/DispersiveShallowWater.jl/docs/build/shoaling_solution.png&quot;</code></pre><p><img src="../shoaling_solution.png" alt/></p><p>By default, this will plot the bathymetry, but not the initial (analytical) solution. You can adjust this by passing the boolean values <code>plot_bathymetry</code> (if <code>true</code> always plot to first subplot) and <code>plot_initial</code>. You can also provide a <code>conversion</code> function that converts the solution. A conversion function should take the values of the primitive variables <code>q</code> at one node, and the <code>equations</code> as input and should return an <code>SVector</code> of any length as output. For a user defined conversion function, there should also exist a function <code>varnames(conversion, equations)</code> that returns a <code>Tuple</code> of the variable names used for labelling. The conversion function can, e.g., be <a href="../ref/#DispersiveShallowWater.prim2cons"><code>prim2cons</code></a> or <a href="../ref/#DispersiveShallowWater.waterheight_total"><code>waterheight_total</code></a> if one only wants to plot the total waterheight. The resulting plot will have one subplot for each of the returned variables of the conversion variable. By default, the conversion function is just <a href="../ref/#DispersiveShallowWater.prim2prim-Tuple{Any, DispersiveShallowWater.AbstractEquations}"><code>prim2prim</code></a>, i.e. the identity.</p><p>Plotting an animation over time can, e.g., be done by the following command, which uses <code>step</code> to plot the solution at a specific time step.</p><pre><code class="language-julia hljs">anim = @animate for step in 1:length(sol.u)
    plot(semi =&gt; sol, plot_initial = true, conversion = waterheight_total, step = step, xlim = (-50, 20), ylims = [(-0.8, 0.1)])
end
gif(anim, &quot;shoaling_solution.gif&quot;, fps = 25)</code></pre><img src="3639d8bd.gif" alt="Example block output"/><p>It is also possible to plot the solution variables at a fixed spatial point over time by calling <code>plot(semi =&gt; sol, x)</code> for some <code>x</code>-value, see <a href="https://github.com/JoshuaLampert/2023-master-thesis/blob/main/code/plot_examples.jl">plot_examples.jl</a> from the reproducibility repository of the master thesis of Joshua Lampert for some examples.</p><p>Often, it is interesting to have a look at how the quantities that are recorded by the <code>AnalysisCallback</code> evolve in time. To this end, you can <code>plot</code> the <code>AnalysisCallback</code> by</p><pre><code class="language-julia hljs">plot(analysis_callback)
savefig(&quot;analysis_callback.png&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/DispersiveShallowWater.jl/DispersiveShallowWater.jl/docs/build/analysis_callback.png&quot;</code></pre><p>This creates the following figure:</p><p><img src="../analysis_callback.png" alt/></p><p>You can see that the linear invariants <span>$\int_\Omega\eta\textrm{d}x$</span> and <span>$\int_\Omega v\textrm{d}x$</span> are indeed conserved exactly. The entropy, however, starts growing at around <span>$t = 17$</span>  and rises up to approximately <span>$5e-5$</span>. This is because of the fact that, during the time integration, a nonlinear invariant is not necessarily conserved, even if the semidiscretization conserves the quantity exactly. How to obtain a fully-discrete structure-preserving numerical scheme is explained in the following section.</p><h2 id="Use-entropy-conserving-time-integration"><a class="docs-heading-anchor" href="#Use-entropy-conserving-time-integration">Use entropy-conserving time integration</a><a id="Use-entropy-conserving-time-integration-1"></a><a class="docs-heading-anchor-permalink" href="#Use-entropy-conserving-time-integration" title="Permalink"></a></h2><p>To obtain entropy-conserving time-stepping schemes DispersiveShallowWater.jl uses the relaxation method introduced in <sup class="footnote-reference"><a id="citeref-Ketcheson2019" href="#footnote-Ketcheson2019">[Ketcheson2019]</a></sup> and further developed in <sup class="footnote-reference"><a id="citeref-RanochaSayyariDalcinParsaniKetcheson2020" href="#footnote-RanochaSayyariDalcinParsaniKetcheson2020">[RanochaSayyariDalcinParsaniKetcheson2020]</a></sup>. The relaxation method is implemented as a <a href="../ref/#DispersiveShallowWater.RelaxationCallback"><code>RelaxationCallback</code></a>, which takes a function representing the conserved quantity as the keyword argument <code>invariant</code>. Therefore, we can run the same example as above, but using relaxation on the entropy by simply adding another callback to the <code>CallbackSet</code>:</p><pre><code class="language-julia hljs">analysis_callback = AnalysisCallback(semi; interval = 10,
                                     extra_analysis_errors = (:conservation_error,),
                                     extra_analysis_integrals = (waterheight_total,
                                                                 velocity, entropy),
                                     io = devnull)
relaxation_callback = RelaxationCallback(invariant = entropy)
callbacks = CallbackSet(relaxation_callback, analysis_callback)
sol = solve(ode, Tsit5(), abstol = 1e-7, reltol = 1e-7,
            save_everystep = false, callback = callbacks, saveat = saveat)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: 1st order linear
t: 100-element Vector{Float64}:
  0.0
  0.25252525252525254
  0.5050505050505051
  0.7575757575757576
  1.0101010101010102
  1.2626262626262625
  1.5151515151515151
  1.7676767676767677
  2.0202020202020203
  2.272727272727273
  ⋮
 22.97979797979798
 23.232323232323232
 23.484848484848484
 23.737373737373737
 23.98989898989899
 24.242424242424242
 24.494949494949495
 24.747474747474747
 25.0
u: 100-element Vector{Vector{Float64}}:
 [0.0, 0.0, 0.7, 0.0, 0.0, 0.7, 0.0, 0.0, 0.7, 0.0  …  0.32339181286549706, 1.1159911034969113e-106, 0.0, 0.31754385964912274, 6.2568988186290324e-108, 0.0, 0.31169590643274847, 3.4485093610035348e-109, 0.0, 0.30584795321637426]
 [-3.332266410556691e-56, 8.250693938128724e-57, 0.7, 3.407583642309716e-56, 3.8490501278015398e-59, 0.7, -1.2832354556318063e-56, 4.5801232603284077e-57, 0.7, 9.844890923810958e-57  …  0.32339181286549706, 9.30670509753227e-55, -7.283825400163255e-55, 0.31754385964912274, -3.350861542354207e-55, 2.838655119185712e-55, 0.31169590643274847, 9.268574447724803e-56, -9.95620229491928e-56, 0.30584795321637426]
 [-4.854545545070253e-53, 1.8097193833399515e-53, 0.7, 4.842352321849954e-53, -1.4595167657656438e-55, 0.7, -1.8543498712251333e-53, 9.787486255308402e-54, 0.7, 1.4192559489927457e-53  …  0.32339181286549706, 1.2618974617562503e-51, -1.4764810496891982e-51, 0.31754385964912274, -4.641297573080381e-52, 5.871219778928541e-52, 0.31169590643274847, 1.3208456304778785e-52, -2.098129111059335e-52, 0.30584795321637426]
 [-1.161174020717534e-50, 5.352294982928633e-51, 0.7, 1.1319863540772265e-50, -1.0908116767888405e-52, 0.7, -4.4038264457122423e-51, 2.8256156036521797e-51, 0.7, 3.3633753287785445e-51  …  0.32339181286549706, 2.818771303094653e-49, -4.048100076844979e-49, 0.31754385964912274, -1.0581360622684687e-49, 1.6415282643014427e-49, 0.31169590643274847, 3.0939972995600496e-50, -5.973308375246117e-50, 0.30584795321637426]
 [-1.1119340370914712e-48, 5.886606126151948e-49, 0.7, 1.0619051193616636e-48, -1.8734919750652443e-50, 0.7, -4.1913262441970204e-49, 3.0415055830255834e-49, 0.7, 3.195203669716197e-49  …  0.32339181286549706, 2.533534775326589e-47, -4.151029387758137e-47, 0.31754385964912274, -9.692959041345168e-48, 1.7142717056808075e-47, 0.31169590643274847, 2.906199272580485e-48, -6.343937197528971e-48, 0.30584795321637426]
 [-6.211342952679108e-47, 3.660636442561326e-47, 0.7, 5.815331336869501e-47, -1.5891123999359684e-48, 0.7, -2.3282612408209723e-47, 1.852469822382361e-47, 0.7, 1.7718913654148852e-47  …  0.32339181286549706, 1.3287774802196427e-45, -2.4065136543212134e-45, 0.31754385964912274, -5.180927344176877e-46, 1.0122631249018097e-45, 0.31169590643274847, 1.592610437929165e-46, -3.8100369833174064e-46, 0.30584795321637426]
 [-2.3254164502674176e-45, 1.49216372070005e-45, 0.7, 2.137170722072698e-45, -8.159011679159638e-47, 0.7, -8.674026426679073e-46, 7.406879206110161e-46, 0.7, 6.591082384100245e-46  …  0.32339181286549706, 4.68098574598978e-44, -9.168487035994518e-44, 0.31754385964912274, -1.8589004819059543e-44, 3.9259136618095353e-44, 0.31169590643274847, 5.853439066560083e-45, -1.502097946470543e-44, 0.30584795321637426]
 [-6.392705132782543e-44, 4.400056006120195e-44, 0.7, 5.774116364831327e-44, -2.890195404164474e-45, 0.7, -2.3744167260793885e-44, 2.1453179125315753e-44, 0.7, 1.8017153964783695e-44  …  0.32339181286549706, 1.213217630459334e-42, -2.5326292145530362e-42, 0.31754385964912274, -4.904393213034871e-43, 1.1033961767416291e-42, 0.31169590643274847, 1.5807177915108583e-43, -4.289440699461812e-43, 0.30584795321637426]
 [-1.3787258559015014e-42, 1.0073701524772098e-42, 0.7, 1.2250977911673285e-42, -7.707967242881186e-44, 0.7, -5.102158372622728e-43, 4.8299655820378e-43, 0.7, 3.866589693374949e-43  …  0.32339181286549706, 2.470432749855349e-41, -5.441087426494035e-41, 0.31754385964912274, -1.0161980065048432e-41, 2.410994807691375e-41, 0.31169590643274847, 3.3505134403765806e-42, -9.51963989884522e-42, 0.30584795321637426]
 [-2.432953367861249e-41, 1.8726248798384983e-41, 0.7, 2.1285837948336777e-41, -1.6338186152122516e-42, 0.7, -8.975306003526185e-42, 8.83838082751108e-42, 0.7, 6.79379036762082e-42  …  0.32339181286549706, 4.12034484685199e-40, -9.503844614433176e-40, 0.31754385964912274, -1.7241538314594997e-40, 4.2818692725079266e-40, 0.31169590643274847, 5.812789657041895e-41, -1.7167232499767342e-40, 0.30584795321637426]
 ⋮
 [-0.0021659838088561004, -0.005462316236984093, 0.7, -0.001094995519112734, -0.0029946780624175644, 0.7, -0.0005920726738234917, -0.0016630027332406104, 0.7, 0.0007264876839320953  …  0.32339181286549706, -0.002445583550959626, -0.016317015455508944, 0.31754385964912274, -0.0016212354480480975, -0.013528910892895053, 0.31169590643274847, -0.002396885241065678, -0.015332363345197464, 0.30584795321637426]
 [-0.0024946509575851233, -0.0084743050248458, 0.7, -0.0018211108261936442, -0.008025725779320278, 0.7, -0.0012193167641073581, -0.006688548166333666, 0.7, -0.00043839507595223084  …  0.32339181286549706, -0.002180430239348519, -0.01590186318296433, 0.31754385964912274, -0.0019262159652891774, -0.013401193628169689, 0.31169590643274847, -0.002232448416912339, -0.014629354103318216, 0.30584795321637426]
 [-0.0018597237172830337, -0.008785908167303248, 0.7, -0.002108029863372081, -0.009851920630150779, 0.7, -0.002009838115979129, -0.009018710861238729, 0.7, -0.0018764289682747922  …  0.32339181286549706, -0.0014174867196701073, -0.00995515983630038, 0.31754385964912274, -0.0019200772426444456, -0.012904053282721581, 0.31169590643274847, -0.0015113103521349474, -0.013907495809161828, 0.30584795321637426]
 [-0.0011382887415978525, -0.006526240914208616, 0.7, -0.00197556375734427, -0.007603373094278387, 0.7, -0.002386647597983837, -0.00816566395304658, 0.7, -0.002708923707548109  …  0.32339181286549706, -0.00034409204632861916, -0.004613565382136222, 0.31754385964912274, -0.001150846246748621, -0.011431378783413654, 0.31169590643274847, -0.0008995601062787052, -0.012874967436299362, 0.30584795321637426]
 [-0.0008547943895035529, -0.0035873298420345387, 0.7, -0.0015148921303084792, -0.003843847009732438, 0.7, -0.0019284466945888887, -0.005644129387757395, 0.7, -0.0023946513342133087  …  0.32339181286549706, 0.00048076743678616995, -0.003265547193722709, 0.31754385964912274, -0.00013500790692120215, -0.007808778243089925, 0.31169590643274847, -0.0006613057774831114, -0.009496236940962929, 0.30584795321637426]
 [-0.0007911392786587085, -0.001739356955529783, 0.7, -0.0009192247258541631, -0.0016012733935531107, 0.7, -0.0009360248152808343, -0.0034159764533118787, 0.7, -0.0013305081833949845  …  0.32339181286549706, 0.0007042413951192331, -0.0032091589879662194, 0.31754385964912274, 0.00036098704059875846, -0.002724084533864268, 0.31169590643274847, -0.0005197291955477037, -0.004146557210079549, 0.30584795321637426]
 [-0.0005009119017044855, -0.0010643539943988355, 0.7, -0.0003997104601284641, -0.0013829707632916784, 0.7, -0.00013392608631431288, -0.0022067354929193777, 0.7, -0.00041367937266736314  …  0.32339181286549706, 0.0005317240886544872, -0.0007458554006874356, 0.31754385964912274, 0.0002918660500146939, 0.0014385389505501853, 0.31169590643274847, -0.00014667287237832502, 0.000499635832292766, 0.30584795321637426]
 [7.877033748192985e-5, -0.000421123639625422, 0.7, -5.0759247674148775e-5, -0.0013861889826008653, 0.7, 8.248268091041952e-5, -0.0013829603946880502, 0.7, -0.00014394433252072245  …  0.32339181286549706, 0.0004509502003486085, 0.0034010197767588668, 0.31754385964912274, 0.0002098810724059527, 0.0030986111294803113, 0.31169590643274847, 0.0003882810307982635, 0.0027368433078829644, 0.30584795321637426]
 [0.0006041217258656232, 0.0008950650498073326, 0.7, 0.0001807892600773303, -7.445962324119322e-5, 0.7, -2.4516528465226556e-5, -0.0001493914009533822, 0.7, -0.0002513925977371086  …  0.32339181286549706, 0.0006585897415157567, 0.0056799234308563176, 0.31754385964912274, 0.0004319778826393965, 0.003066796203846808, 0.31169590643274847, 0.0007320680612230762, 0.0033111405751278435, 0.30584795321637426]</code></pre><p>When you use both, an <code>AnalysisCallback</code> and a <code>RelaxationCallback</code>, note that the <code>relaxation_callback</code> needs to come first inside the <code>CallbackSet</code> as it needs to be invoked prior to the <code>analysis_callback</code>, such that the <code>analysis_callback</code> analyzes the solution with the already updated values.</p><p>Plotting the <code>analysis_callback</code> again, we can see that now also the <code>entropy</code> is conserved up to machine precision.</p><pre><code class="language-julia hljs">plot(analysis_callback)
savefig(&quot;analysis_callback_relaxation.png&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;/home/runner/work/DispersiveShallowWater.jl/DispersiveShallowWater.jl/docs/build/analysis_callback_relaxation.png&quot;</code></pre><p><img src="../analysis_callback_relaxation.png" alt/></p><h2 id="customize_solver"><a class="docs-heading-anchor" href="#customize_solver">Customize solver</a><a id="customize_solver-1"></a><a class="docs-heading-anchor-permalink" href="#customize_solver" title="Permalink"></a></h2><p>In the semidiscretization created above, we used the default SBP operators, which are periodic finite difference operators. Using different SBP operators for the semidiscretization can be done leveraging <a href="https://github.com/ranocha/SummationByPartsOperators.jl/">SummationByPartsOperators.jl</a>, which needs to be imported first:</p><pre><code class="language-julia hljs">using SummationByPartsOperators: legendre_derivative_operator, UniformPeriodicMesh1D, couple_discontinuously, PeriodicUpwindOperators</code></pre><p>As an example, let us create a semidiscretization based on discontinuous Galerkin (DG) upwind operators. A semidiscretization implemented in DispersiveShallowWater.jl needs one first-derivative and one second-derivative SBP operator. To build the first-derivative operator, we first create a <code>LegendreDerivativeOperator</code> with polynomial degree 3 on a reference element <code>[-1.0, 1.0]</code> and a <code>UniformPeriodicMesh1D</code> for the coupling.</p><pre><code class="language-julia hljs">mesh = Mesh1D(coordinates_min, coordinates_max, N)
accuracy_order = 4
D_legendre = legendre_derivative_operator(-1.0, 1.0, accuracy_order)
uniform_mesh = UniformPeriodicMesh1D(mesh.xmin, mesh.xmax, div(mesh.N, accuracy_order))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SummationByPartsOperators.UniformPeriodicMesh1D{Float64} with 128 cells in (-130.0, 20.0)</code></pre><p>Upwind DG operators in negative, central and positive operators can be obtained by <code>couple_discontinuously</code></p><pre><code class="language-julia hljs">central = couple_discontinuously(D_legendre, uniform_mesh)
minus = couple_discontinuously(D_legendre, uniform_mesh, Val(:minus))
plus = couple_discontinuously(D_legendre, uniform_mesh, Val(:plus))
D1 = PeriodicUpwindOperators(minus, central, plus)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Upwind SBP first-derivative operators of order 3 on a grid in [-129.99999999999997, 19.999999999999996] using 512 nodes 
and coefficients of Module</code></pre><p>In order to still have an entropy-conserving semidiscretization the second-derivative SBP operator needs to be</p><pre><code class="language-julia hljs">using SparseArrays: sparse
D2 = sparse(plus) * sparse(minus)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">512×512 SparseArrays.SparseMatrixCSC{Float64, Int64} with 3072 stored entries:
⎡⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⎤
⎢⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⠀⠀⎥
⎢⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⡀⠀⎥
⎣⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣦⎦</code></pre><p>The <a href="../ref/#DispersiveShallowWater.Solver"><code>Solver</code></a> object can now be created by passing the two SBP operators to the constructor, which, in turn, can be used to construct a <code>Semidiscretization</code>:</p><pre><code class="language-julia hljs">solver = Solver(D1, D2)
semi = Semidiscretization(mesh, equations, initial_condition, solver, boundary_conditions = boundary_conditions)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Semidiscretization
    #spatial dimensions: 1
    mesh: Mesh1D{Float64} with length 512
    equations: BBMBBMVariableEquations1D
    initial condition: initial_condition_shoaling
    boundary condition: boundary_condition_periodic
    source terms: nothing</code></pre><p>As before, we can run the simulation by</p><pre><code class="language-julia hljs">analysis_callback = AnalysisCallback(semi; interval = 10,
                                     extra_analysis_errors = (:conservation_error,),
                                     extra_analysis_integrals = (waterheight_total,
                                                                 velocity, entropy),
                                     io = devnull)
relaxation_callback = RelaxationCallback(invariant = entropy)
callbacks = CallbackSet(relaxation_callback, analysis_callback)
sol = solve(ode, Tsit5(), abstol = 1e-7, reltol = 1e-7,
            save_everystep = false, callback = callbacks, saveat = saveat)
anim = @animate for step in 1:length(sol.u)
    plot(semi =&gt; sol, plot_initial = true, conversion = waterheight_total, step = step, xlim = (-50, 20), ylims = [(-0.8, 0.1)])
end
gif(anim, &quot;shoaling_solution_dg.gif&quot;, fps = 25)</code></pre><img src="cef69741.gif" alt="Example block output"/><p>For more details see also the <a href="https://ranocha.de/SummationByPartsOperators.jl/stable/">documentation of SummationByPartsOperators.jl</a></p><h2 id="Additional-resources"><a class="docs-heading-anchor" href="#Additional-resources">Additional resources</a><a id="Additional-resources-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-resources" title="Permalink"></a></h2><p>Some more examples sorted by the simulated equations can be found in the <a href="https://github.com/JoshuaLampert/DispersiveShallowWater.jl/tree/main/examples">examples/</a> subdirectory. Especially, in <a href="https://github.com/JoshuaLampert/DispersiveShallowWater.jl/tree/main/examples/svaerd_kalisch_1d">examples/svaerd_kalisch_1d/</a> you can find Julia scripts that solve the <a href="../ref/#DispersiveShallowWater.SvaerdKalischEquations1D"><code>SvaerdKalischEquations1D</code></a> that were not covered in this tutorial. The same steps as described above, however, apply in the same way to these equations. Attention must be paid for these equations because they do not conserve the classical total entropy <span>$\mathcal E$</span>, but a modified entropy <span>$\hat{\mathcal E}$</span>, available as <a href="../ref/#DispersiveShallowWater.entropy_modified-Tuple{Any, SvaerdKalischEquations1D, Any}"><code>entropy_modified</code></a>.</p><p>More examples, especially focussing on plotting, can be found in the scripts <a href="https://github.com/JoshuaLampert/2023-master-thesis/blob/main/code/create_figures.jl">create_figures.jl</a> and <a href="https://github.com/JoshuaLampert/2023-master-thesis/blob/main/code/plot_examples.jl">plot_examples.jl</a> from the reproducibility repository of the master thesis of Joshua Lampert.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-IsrawiKalischKatsaounisMitsotakis2021"><a class="tag is-link" href="#citeref-IsrawiKalischKatsaounisMitsotakis2021">IsrawiKalischKatsaounisMitsotakis2021</a>Israwi, Kalisch, Katsaounis, Mitsotakis (2021). A regularized shallow-water waves system with slip-wall boundary conditions in a basin: theory and numerical analysis. <a href="https://doi.org/10.1088/1361-6544/ac3c29">DOI: 10.1088/1361-6544/ac3c29</a></li><li class="footnote" id="footnote-Ketcheson2019"><a class="tag is-link" href="#citeref-Ketcheson2019">Ketcheson2019</a>Ketcheson (2019): Relaxation Runge-Kutta Methods: Conservation and stability for Inner-Product Norms. <a href="https://doi.org/10.1137/19M1263662">DOI: 10.1137/19M1263662</a></li><li class="footnote" id="footnote-RanochaSayyariDalcinParsaniKetcheson2020"><a class="tag is-link" href="#citeref-RanochaSayyariDalcinParsaniKetcheson2020">RanochaSayyariDalcinParsaniKetcheson2020</a>Ranocha, Sayyari, Dalcin, Parsani, Ketcheson (2020): Relaxation Runge–Kutta Methods: Fully-Discrete Explicit Entropy-Stable Schemes for the Compressible Euler and Navier–Stokes Equations <a href="https://doi.org/10.1137/19M1263480">DOI: 10.1137/19M1263480</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../ref/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 19 December 2023 13:32">Tuesday 19 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
